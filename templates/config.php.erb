<?php
$config = array (
  'debug' => <%= @debug -%>,
  'site_admin_debug' => <%= @site_admin_debug -%>,
  'Security' =>
    array (
     'level' => '<%= @security_level -%>',
     'salt' => '<%= @salt -%>',
     'cipherSeed' => '<%= @cipherseed -%>',
     <% if (@auth_method != '') then %>
     'auth'=>array('<%= @auth_method -%>'),
     <% else %>
     //'auth'=>array('CertAuth.Certificate'), // additional  authentication methods
     <% end %>
     'password_policy_length' => <%= @password_policy_length -%>,
     'password_policy_complexity' => '<%= @password_policy_complexity -%>',
     'sanitise_attribute_on_delete' => <%= @sanitise_attribute_on_delete -%>,
     'require_password_confirmation' => <%= @require_password_confirmation -%>,
     'hide_organisation_index_from_users' => <%= @hide_organisation_index_from_users -%>,
     ),
  'MISP' =>
    array (
      'uuid' => '<%= @uuid -%>',
      'baseurl' => 'https://<%= @fqdn -%>',
      'live'  => <%= @live -%>,
      'language' => '<%= @language -%>',
      'enable_advanced_correlations' => <%= @enable_advanced_correlations -%>,
<% if @python_bin -%>
      'python_bin' => '<%= @python_bin %>',
<% end -%>
      'ssdeep_correlation_threshold' => <%= @ssdeep_correlation_threshold -%>,
      'max_correlations_per_event' => <%= @max_correlations_per_event -%>,
      'maintenance_message' => '<%= @maintenance_message -%>',
      'footermidleft' => '<%= @footermidleft -%>',
      'footermidright' => '<%= @footermidright -%>',
      'footer_logo' => '<%= @footer_logo -%>',
      'home_logo' => '<%= @home_logo -%>',
      'main_logo' => '<%= @main_logo -%>',
      'org' => '<%= @org -%>',
      'host_org_id' => '<%= @host_org_id -%>',
      'showorg' => <%= @showorg -%>,
      'threatlevel_in_email_subject' => <%= @threatlevel_in_email_subject -%>,
      'email_subject_TLP_string' => '<%= @email_subject_tlp_string -%>',
      'email_subject_tag' => '<%= @email_subject_tag -%>',
      'email_subject_include_tag_name' => <%= @email_subject_include_tag_name -%>,
      'background_jobs' => <%= @background_jobs -%>,
      'attachments_dir' => '<%= @attachments_dir -%>',
      'cached_attachments' => <%= @cached_attachments -%>,
      'download_attachments_on_load' => <%= @download_attachments_on_load -%>,
      'email' => '<%= @email -%>',
      'disable_emailing' => <%= @disable_emailing -%>,
      'contact' => '<%= @contact -%>',
      'cveurl' => '<%= @cveurl -%>',
      'disablerestalert' => <%= @disablerestalert -%>,
      'extended_alert_subject' => <%= @extended_alert_subject -%>,
      'default_event_distribution' => '<%= @default_event_distribution -%>',
      'default_attribute_distribution' => '<%= @default_attribute_distribution -%>',
      'default_event_threat_level' => '<%= @default_event_threat_level -%>',
      'tagging' => <%= @tagging -%>,
      'full_tags_on_event_index' => <%= @full_tags_on_event_index -%>,
      'welcome_text_top' => '<%= @welcome_text_top -%>',
      'welcome_text_bottom' => '<%= @welcome_text_bottom -%>',
      'welcome_logo' => '<%= @welcome_logo -%>',
      'welcome_logo2' => '<%= @welcome_logo2 -%>',
      'title_text' => '<%= @title_text -%>',
      'take_ownership_xml_import' => <%= @take_ownership_xml_import -%>,
      'terms_download' => <%= @terms_download -%>,
      'terms_file' => '<%= @terms_file -%>',
      'showorgalternate' => <%= @showorgalternate -%>,
      'unpublishedprivate' => <%= @unpublishedprivate -%>,
      'newUserText' => "<%= @new_user_text -%>",
      'passwordResetText' => "<%= @password_reset_text -%>",
      'enableEventBlacklisting' => <%= @enable_event_blacklisting -%>,
      'enableOrgBlacklisting' => <%= @enable_org_blacklisting -%>,
      'log_client_ip' => <%= @log_client_ip -%>,
      'log_auth' => <%= @log_auth -%>,
      'ManglePushTo23' => <%= @mangle_push_to_23 -%>,
      'delegation' => <%= @delegation -%>,
      'showCorrelationsOnIndex' => <%= @show_correlations_on_index -%>,
      'showProposalsCountOnIndex' => <%= @show_proposals_count_on_index -%>,
      'showSightingsCountOnIndex' => <%= @show_sightings_count_on_index -%>,
      'showDiscussionsCountOnIndex' => <%= @show_discussions_count_on_index -%>,
      'disableUserSelfManagement' => <%= @disable_user_self_management -%>,
      'block_event_alert' => <%= @block_event_alert -%>,
      'block_event_alert_tag' => '<%= @block_event_alert_tag -%>',
      'block_old_event_alert' => <%= @block_old_event_alert -%>,
      'block_old_event_alert_age' => <%= @block_old_event_alert_age -%>,
      'rh_shell_fix' => <%= @rh_shell_fix -%>,
      'rh_shell_fix_path' => '<%= @rh_shell_fix_path -%>',
      'tmpdir' => '<%= @tmpdir -%>',
      'custom_css' => '<%= @custom_css -%>',
      'proposals_block_attributes' => <%= @proposals_block_attributes -%>,
      'incoming_tags_disabled_by_default' => <%= @incoming_tags_disabled_by_default -%>,
      'completely_disable_correlation' => <%= @completely_disable_correlation -%>,
      'allow_disabling_correlation' => <%= @allow_disabling_correlation -%>,
      'redis_host' => '<%= @redis_host -%>',
      'redis_port' => <%= @redis_port -%>,
      'redis_database' => <%= @redis_database -%>,
      'redis_password' => '<%= @redis_password -%>',
      'event_view_filter_fields' => '<%= @event_view_filter_fields -%>',
      'manage_workers' => '<%= @manage_workers -%>',
      'deadlock_avoidance' => <%= @deadlock_avoidance -%>,
      'allow_unsafe_apikey_named_param' => <%= @allow_unsafe_apikey_named_param -%>,
    ),
  'GnuPG' =>
    array (
      'binary' => '<%= @gpg_binary -%>',
      'onlyencrypted' => <%= @gpg_onlyencrypted -%>,
      'bodyonlyencrypted' => <%= @gpg_bodyonlyencrypted -%>,
      'email' => '<%= @gpg_email -%>',
      'password' => '<%= @gpg_password -%>',
      'homedir' => '<%= @gpg_homedir -%>',
    ),
  'SMIME' =>
    array (
      'enabled' => <%= @smime_enabled -%>,
      'email' => '<%= @smime_email -%>',
      'cert_public_sign' => '<%= @smime_cert_public_sign -%>',
      'key_sign' => '<%= @smime_key_sign -%>',
      'password' => '<%= @smime_password -%>',
    ),
  'Proxy' =>
    array (
      'host' => '<%= @proxy_host -%>',
      'port' => '<%= @proxy_port -%>',
      'method' => '<%= @proxy_method -%>',
      'user' => '<%= @proxy_user -%>',
      'password' => '<%= @proxy_password -%>',
    ),
  'SecureAuth' =>
    array (
      'amount' => <%= @secure_auth_amount -%>,
      'expire' => <%= @secure_auth_expire -%>,
    ),
  'Session' =>
    array (
      'autoRegenerate' => <%= @session_auto_regenerate -%>,
      'checkAgent' => '<%= @session_check_agent -%>',
      'defaults' => '<%= @session_defaults -%>',
      'timeout' => '<%= @session_timeout -%>',
      'cookie_timeout' => '<%= @session_cookie_timeout -%>'
    ),
  'Plugin' =>
    array (
      'RPZ_policy' => <%= @rpz_policy -%>,
      'RPZ_walled_garden' => '<%= @rpz_walled_garden -%>',
      'RPZ_serial' => '<%= @rpz_serial -%>',
      'RPZ_refresh' => '<%= @rpz_refresh -%>',
      'RPZ_retry' => '<%= @rpz_retry -%>',
      'RPZ_expiry' => '<%= @rpz_expiry -%>',
      'RPZ_minimum_ttl' => '<%= @rpz_minimum_ttl -%>',
      'RPZ_ttl' => '<%= @rpz_ttl -%>',
      'RPZ_ns' => '<%= @rpz_ns -%>.',
      'RPZ_ns_alt' => '<%= @rpz_ns_alt -%>',
      'RPZ_email' => '<%= @rpz_email -%>',
      'ZeroMQ_enable' => <%= @zeromq_enable -%>,
      'ZeroMQ_port' => <%= @zeromq_port -%>,
      'ZeroMQ_redis_host' => '<%= @zeromq_redis_host -%>',
      'ZeroMQ_redis_port' => <%= @zeromq_redis_port -%>,
      'ZeroMQ_redis_password' => '<%= @zeromq_redis_password -%>',
      'ZeroMQ_redis_database' => '<%= @zeromq_redis_database -%>',
      'ZeroMQ_redis_namespace' => '<%= @zeromq_redis_namespace -%>',
      'ZeroMQ_include_attachments' => <%= @zeromq_include_attachments -%>,
      'ZeroMQ_event_notifications_enable' => <%= @zeromq_event_notifications_enable -%>,
      'ZeroMQ_object_notifications_enable' => <%= @zeromq_object_notifications_enable -%>,
      'ZeroMQ_object_reference_notifications_enable' => <%= @zeromq_object_reference_notifications_enable -%>,
      'ZeroMQ_attribute_notifications_enable' => <%= @zeromq_attribute_notifications_enable -%>,
      'ZeroMQ_tag_notifications_enable' => <%= @zeromq_tag_notifications_enable -%>,
      'ZeroMQ_audit_notifications_enable' => <%= @zeromq_audit_notifications_enable -%>,
      'ElasticSearch_logging_enable' => <%= @elasticsearch_logging_enable -%>,
      'ElasticSearch_connection_string' => '<%= @elasticsearch_connection_string -%>',
      'ElasticSearch_log_index' => '<%= @elasticsearch_log_index -%>',
      'syslog' => <%= @syslog -%>,
      'Sightings_enable' => <%= @sightings_enable -%>,
      'Sightings_policy' => <%= @sightings_policy -%>,
      'Sightings_anonymise' => <%= @sightings_anonymise -%>,
      'Sightings_range' => <%= @sightings_range -%>,
      'CustomAuth_enable' => <%= @customauth_enable -%>,
      'CustomAuth_header' => '<%= @customauth_header -%>',
      'CustomAuth_use_header_namespace' => <%= @customauth_use_header_namespace -%>,
      'CustomAuth_header_namespace' => '<%= @customauth_header_namespace -%>',
      'CustomAuth_required' => <%= @customauth_required -%>,
      'CustomAuth_only_allow_source' => '<%= @customauth_only_allow_source -%>',
      'CustomAuth_name' => '<%= @customauth_name -%>',
      'CustomAuth_disable_logout' => <%= @customauth_disable_logout -%>,
      'CustomAuth_custom_password_reset' => '<%= @customauth_custom_password_reset -%>',
      'CustomAuth_custom_logout' => '<%= @customauth_custom_logout -%>',
      'Enrichment_services_enable' => <%= @enrichment_services_enable -%>,
      'Enrichment_timeout' => <%= @enrichment_timeout -%>,
      'Enrichment_hover_enable' => <%= @enrichment_hover_enable -%>,
      'Enrichment_hover_timeout' => <%= @enrichment_hover_timeout -%>,
      'Enrichment_services_url' => '<%= @enrichment_services_url -%>',
      'Enrichment_services_port' => <%= @enrichment_services_port -%>,
      'Import_services_enable' => <%= @import_services_enable -%>,
      'Import_timeout' => <%= @import_timeout -%>,
      'Import_services_url' => '<%= @import_services_url -%>',
      'Import_services_port' => <%= @import_services_port -%>,
      'Export_services_enable' => <%= @export_services_enable -%>,
      'Export_timeout' => <%= @export_timeout -%>,
      'Export_services_url' => '<%= @export_services_url -%>',
      'Export_services_port' => <%= @export_services_port -%>,
      'Cortex_services_enable' => <%= @cortex_services_enable -%>,
      'Cortex_services_url' => '<%= @cortex_services_url -%>',
      'Cortex_services_port' => <%= @cortex_services_port -%>,
      'Cortex_authkey' => '<%= @cortex_authkey -%>',
      'Cortex_timeout' => <%= @cortex_timeout -%>,
      'Cortex_ssl_verify_peer' => <%= @cortex_ssl_verify_peer -%>,
      'Cortex_ssl_verify_host' => <%= @cortex_ssl_verify_host -%>,
      'Cortex_ssl_allow_self_signed' => <%= @cortex_ssl_allow_self_signed -%>,
      'Cortex_ssl_cafile' => '<%= @cortex_ssl_cafile -%>'
    ),
  // Uncomment the following to enable client SSL certificate authentication
  /*
  'CertAuth' =>
  array(
    'ca'    => array( 'FIRST.Org' ), // allowed CAs
    'caId'          => 'O',          // which attribute will be used to verify the CA
    'userModel'     => 'User',       // name of the User class to check if user exists
    'userModelKey'  => 'nids_sid',   // User field that will be used for querying
    'map'           => array(        // maps client certificate attributes to User properties
      'O'           => 'org',
      'emailAddress'=>'email',
    ),
    'syncUser'      => true,         // should the User be synchronized with an external REST API
    'userDefaults'=> array(          // default user attributes, only used when creating new users
      'role_id'   => 4,
    ),
    'restApi'       => array(        // API parameters
      'url'         => 'https://example.com/data/users',  // URL to query
      'headers'     => array(),                           // additional headers, used for authentication
      'param'       => array( 'email' => 'email' ),       // query parameters to add to the URL, mapped to User properties
      'map'         =>  array(                            // maps REST result to the User properties
        'uid'       => 'nids_sid',
        'team'      => 'org',
        'email'     => 'email',
        'pgp_public'=> 'gpgkey',
      ),
    ),
    'userDefaults'  => array ( 'role_id' => 3 ),          // default attributes for new users
  ),
  */
    'ApacheShibbAuth'  =>                      // Configuration for shibboleth authentication
      array(
      'MailTag'           => 'ADFS_EMAIL',
      'OrgTag'            => 'ADFS_FEDERATION',
      'GroupTag'          => 'ADFS_GROUP',
      'GroupSeparator'    => ';',
      'GroupRoleMatching' => array(                // 3:User, 1:admin. May be good to set "1" for the first user
        <% @egroup_role_match.each do |key,value| -%>
        '<%= key %>' => <%= value %>,
        <% end %>
      ),
      'UseDefaultOrg'     => '<%= @shib_use_default_org -%>',
      'DefaultOrg'        => '<%= @shib_default_org -%>',
    ),

  // Warning: The following is a 3rd party contribution and still untested (including security) by the MISP-project team.
  // Feel free to enable it and report back to us if you run into any issues.
  //
  // Uncomment the following to enable Kerberos authentication
  // needs PHP LDAP support enabled (e.g. compile flag --with-ldap or Debian package php5-ldap)
<% unless @apache_auth_enable -%>
  /*
<% end -%>
  'ApacheSecureAuth' => // Configuration for kerberos authentication
  array(
    'apacheEnv' => '<%= @apache_auth_apache_env -%>',           // If proxy variable = HTTP_REMOTE_USER
    'ldapServer' => '<%=  @apache_auth_ldap_server -%>',   // FQDN or IP
    'ldapProtocol' => '<%= @apache_auth_ldap_protocol -%>',
    'ldapReaderUser' => '<%= @apache_auth_ldap_reader_user -%>', // DN ou RDN LDAP with reader user right
    'ldapReaderPassword' => '<%= @apache_auth_ldap_reader_password -%>', // the LDAP reader user password
    'ldapDN' => '<%= @apache_auth_ldap_dn -%>',
    'ldapSearchFilter' => '<%= @apache_auth_ldap_search_filter  -%>',
    'ldapSearchAttribut' => '<%= @apache_auth_ldap_search_attribut -%>',          // filter for search
    'ldapFilter' => array(
<% @apache_auth_ldap_filter.each do |ldap_filter| -%>
                          '<%= ldap_filter -%>',
<% end -%>
                          ),
    'ldapDefaultRoleId' => '<%= @apache_auth_ldap_default_role_id -%>',               // 3:User, 1:admin. May be good to set "1" for the first user
    'ldapDefaultOrg' => '<%= @apache_auth_ldap_default_org -%>',      // uses 1st local org in MISP if undefined
    ),
<% unless @apache_auth_enable -%>
  */
<% end -%>
);
